{include 'tpl/fullStopName.html'}
{include 'tpl/infos1.html'}
{include 'tpl/options.html'}
{include 'tpl/displayStopsTimetable.html'}
{assign "ar" [$stopName[0],$stopName[1],$stopName[2],$stopName[3]]}
{*$infosLen = $infos|strlen*}
{*$infosLen*}
<div class="line_info">
Rozkład jazdy linii nr <span class="line">{$wLine}</span><br>
Odjazdy z przystanku <span class="stop_name">{call writeFullStopName}</span><br>
W kierunku: <span class="direction_name">{$dirName}</span>
</div>

{if $hours|count == 0 or $allMinsCount==0}
<div class="line_info">
Przystanek dla wysiadających<br>
Brak odjazdów z tego przystanku
</div>
{else}
<table class="departures">
	<tr class="hours">
		<td class="hour hour_info" colspan="2">Godziny</td>
		{foreach $hours as $hour}
		<td class="hour">{$hour}</td>
		{/foreach}
		{*<td rowspan="{if $infosLen < 10}{$dayTypes|count + 2}{else}{$dayTypes|count + 3}{/if}" class="route">*}
		<td rowspan="{if $currentSigns|count == 0}{$minsAndDayTypesCount + 2}{else}{$minsAndDayTypesCount + 3}{/if}" class="route{if $wPrint=="pdf" or $wPrint=="pdf5"} pdf{/if}">
			{call displayStopsTimetable}
		</td>
	</tr> {*poniżej wypisywanie minut!*}
	
	{$i=0}
	{$j=0}
	{foreach $mins as $min}
	{if $minsCount[$i] != 0}
	<tr class="departures">
		<td class="day_type">{$dayTypes[$i][1]}</td>
		{if $j==0}
		<td class="mins_text" rowspan="{$minsAndDayTypesCount}">m<br>i<br>n<br>u<br>t<br>y</td>
		{/if}
		{$h=0}
		{foreach $min as $m}
		<td>
			{foreach $m as $mm}
				{$cTime = $hours[$h]|cat:":"|cat:$mm[0]}
				{*passed time thanks to: http://stackoverflow.com/questions/2832467/php-how-can-i-check-if-the-current-date-time-is-past-a-set-date-time*}
					{if $mm[4]==2}
						{$status="starting"}
					{elseif $mm[4]==1}
						{$status="ending"}
					{else}
						{$status=""}
					{/if}
				{if $wPrint==null}
				<a{if $currTime > $cTime|strtotime} class="passed {$status}"{elseif $nextTimeHour > $cTime|strtotime} class="next {$status}"{else} class="{$status}"{/if} href="?line={$wLine}&amp;dir={$wDir}&amp;stop={$wStop}&amp;course={$mm[2]}&amp;day={$mm[3]}{call options}">{$mm[0]}<sup>{$mm[1]}</sup></a><br>
				{else}
					{if $status=="starting"}
						{$css = "color: green;"}
						{$color = "green"}
					{elseif $status=="ending"}
						{$css = "color: red;"}
						{$color = "red"}
					{else}
						{$css=""}
						{$color = "black"}
					{/if}
					<span style="{$css}">{$mm[0]}{if $wPrint=="pdf5" and $mm[1]|strlen>=1}<br>{/if}{$mm[1]}</span><br>
				{/if}
			{/foreach}
		</td>
		{$h=$h+1}
		{/foreach}
	</tr>
	{$j=$j+1}
	{/if}
	{$i=$i+1}
	{/foreach}
	{if $currentSigns|count > 0}
	<tr>
		<td class="infos" colspan="{$hours|count+2}">
			Oznaczenia:<br>
			{*$infos*}{call writeInfos1}
		</td>
	</tr>
	{/if}
	<tr>
		<td class="infos valid" colspan="{$hours|count+2}">
			Rozkład jazdy obowiązuje od	{$date}
		</td>
	</tr>
</table>

{if $wPrint==null}
{if $otherLines|count>1}
<div class="other_lines">
	<span class="info">Inne linie kursujące z tego przystanku:</span><br>
	{foreach $otherLines as $otherLine}
	{if $otherLine[1]!=$wDir or $otherLine[0]!=$wLine}
	<a class="depatrure" href="?line={$otherLine[0]}&amp;dir={$otherLine[1]}&amp;stop={$wStop}{call options}">Linia <span class="line">{$otherLine[0]}</span> w kierunku <span class="direction_name">{$otherLine[2]}</span></a><br>
	{/if}
	{/foreach}
</div>
{/if}
{/if}

{/if}
