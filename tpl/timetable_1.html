{include 'tpl/fullStopName.html'}
{include 'tpl/infos1.html'}
{include 'tpl/options.html'}
{include 'tpl/displayStopsTimetable.html'}
{assign "ar" [$stopName[0],$stopName[1],$stopName[2],$stopName[3]]}
{*$infosLen = $infos|strlen*}
<div class="line_info">
{$lang.timetable_schedule_line} <span class="line">{$wLine}</span><br>
{$lang.timetable_deps_from_stop} <span class="stop_name">{call writeFullStopName}</span><br>
{$lang.timetable_direction}: <span class="direction_name">{$dirName}</span>
</div>

<table class="departures" border="1">
	<tr class="main_table">
		<td rowspan="2">
			{if $hours|count == 0 or $allMinsCount==0}
					<table class="departures">
						<tr>
							<td>
								{$lang.timetable_only_exit}
							</td>
						</tr>
					</table>
			{else}
				<table class="departures">
					<tr class="day_name">
						<td class="hour">{$lang.timetable_hours}</td>
						{$i=0}
						{foreach $dayTypes as $dT}
							{if $minsCount[$i] != 0}
								<td class="day_name">
									{$dT[1]}
								</td>
							{/if}
							{$i=$i+1}
						{/foreach}
					</tr>
					
					{$h=0}
					{foreach $hours as $hour}
						<tr class="hour_row">
							<td class="hour">{$hour}</td>
							{$j=0}
							{foreach $mins as $min}
							{if $minsCount[$j] != 0}
								<td class="mins">
									{foreach $min[$h] as $m}
										{$cTime = $hour|cat:":"|cat:$m[0]}
										{*passed time thanks to: http://stackoverflow.com/questions/2832467/php-how-can-i-check-if-the-current-date-time-is-past-a-set-date-time*}
										{if $m[4]==2}
											{$status="starting"}
										{elseif $m[4]==1}
											{$status="ending"}
										{else}
											{$status=""}
										{/if}
										{if $wPrint==null}
											<span class="hour_block"><a{if $currTime > $cTime|strtotime} class="passed {$status}"{elseif $nextTimeHour > $cTime|strtotime} class="next {$status}"{else} class="{$status}"{/if} href="?line={$wLine}&amp;dir={$wDir}&amp;stop={$wStop}&amp;course={$m[2]}&amp;day={$m[3]}{call options}">{$m[0]}<sup>{$m[1]}</sup></a></span>
										{else}
											{if $status=="starting"}
												{$css = "color: green;"}
												{$color = "green"}
											{elseif $status=="ending"}
												{$css = "color: red;"}
												{$color = "red"}
											{else}
												{$css=""}
												{$color = "black"}
											{/if}
											<span class="hour_block" style="{$css}">{$m[0]}{$m[1]}</span>
										{/if}
									{/foreach}
								</td>
							{/if}
							{$j=$j+1}
						{/foreach}
						</tr>
						{$h=$h+1}
					{/foreach}	
				</table>
			{/if}
		</td>
		
		<td class="route_header">
			{$lang.timetable_route}:
		</td>
	</tr>
	<tr class="route">
		<td class="route" {if $currentSigns|count > 0}rowspan="3"{else}rowspan="2"{/if}>
			{call displayStopsTimetable}
		</td>
	</tr>
	{if $currentSigns|count > 0}
		<tr>
			<td class="infos">
				{call writeInfos1}
			</td>
		</tr>
	{/if}
	<tr>
		<td class="infos ">
			{$lang.timetable_valid} {$date}
		</td>
	</tr>
</table>

{if $wPrint==null}
	{if $otherLines|count>1}
		<div class="other_lines">
			<span class="info">{$lang.timetable_oth_lines}:</span><br>
			{foreach $otherLines as $otherLine}
			{if $otherLine[1]!=$wDir or $otherLine[0]!=$wLine}
			<a class="depatrure" href="?line={$otherLine[0]}&amp;dir={$otherLine[1]}&amp;stop={$wStop}{call options}">{$lang.timetable_oth_line} <span class="line">{$otherLine[0]}</span> {$lang.timetable_oth_dir} <span class="direction_name">{$otherLine[2]}</span></a><br>
			{/if}
			{/foreach}
		</div>
	{/if}
{/if}